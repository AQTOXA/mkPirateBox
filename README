###########################################################################
# mkPirateBox v0.2-4
# IPKG that installs PirateBox to your fresh OpenWRT router
# (C) 2011, Christiane Ruetten, cr@23bit.net
#
# Released under GPLv2, see http://www.gnu.org/licenses/gpl-2.0.html

FEATURES:
 - Install this IPKG on your fresh OpenWRT "Backfire", and out comes
   (hopefully) a ready-to-use PirateBox.
 - Now supports devices with 4 MByte flash
 - Tested on
   - Asus WL-500gP (brcm47xx)
   - Asus WL-500g (brcm47xx)
   - Buffalo WZR-HP-G300NH (ar71xx)

TODO:
 - Test other platforms
 - Does not uninstall cleanly
 - Better error checking

PLEASE HELP:
 - I expect mkPirateBox v0.2+ to run on many or even most untested router
   models. If something goes wrong, installation will most likely fail
   during wireless setup. I usually can make it easily work if you help me
   out. If you decide to try mkPirateBox on an untested router model,
   please send send me feedback on how it went, including
   - your router model
   - output of the command
     "cat /etc/openwrt_release /etc/config/wireless /etc/config/network".
 - Thanks! :)

REQUIREMENTS:
 - Decently powerful router with USB2.0 port which is supported by OpenWRT.
   Minimum requirements are 125 MHz, 16 MByte RAM and 4 GByte flash, but I
   recommend 250 MHz, 32 MByte RAM and 8 MByte flash. The following models
   meet or exceed the recommendation and should work out of the box:
   - TD-Link TL-WR1043ND (ar71xx, cheap!)
   - Asus WL-500gP (brcm47xx, white, discontinued)
   - Buffalo WZR-HP-G300NH (ar71xx, hardwired antennas)
   - D-Link DIR-825 (ar71xx, white)
   - Linksys WRT160NL (ar71xx)
 - 125 MHz systems work, but HTTP uploads may drop dramatically to
   about 100 KByte/s.
 - An external USB hard drive (UMS compatible) formattet with FAT32.
   Keep in mind that some routers are unable to provide sufficient
   USB power to spin-up HD drives, while USB flash drives should work
   fine in any case.
 - Two ethernet cables

INSTALL:
  - Install a fresh OpenWRT "Backfire" 10.03.1 onto your router.
    I mean really fresh. Do not touch it after you flashed it!
    If you already have an unclean install, do a reflash or
    rm -rf /overlay/* and reboot the router.
  - Please note that some systems don't support easy wipes with
    the rm -rf /overlay/* method. You can spot these by an empty
    /verlay directory. In these cases, you mus reflash the
    OpenWRT image for a clean install.
  - Make sure your Internet router does not use the IP address
    192.168.1.1 or any other address from the 192.168.1.0 subnet.
    Set it to 192.168.42.1 (with subnet mask 255.255.255.0),
    for example.
  - Connect the WAN port of the PirateBox to your Internet router
    and one of its LAN ports your computer. This ensures the
    PirateBox router can download the required packages.
  - Connect your USB drive. The script assumes a single partition
    with a FAT32 file system.
  - telnet into the router on 192.168.1.1.
  - cd /tmp
  - wget http://cr.23bit.net/piratebox/piratebox_0.2-4_all.ipk
    (Sorry, github only supports https downloads.)
  - opkg update && opkg install piratebox*
  - When prompted, set a root password.
  - Wait for the setup to finish which is when the open wireless
    network "PirateBox" appears.
  - Connect wirelessly and open any web page.
  - If you see the PirateBox menu, you're done.
  - You can disconnect the WAN connection now.
  - To start over or completely uninstall, rm -rf /overlay/* and
    reboot or reflash OpenWRT.

USAGE:
  - /etc/piratebox.common has the global config on top. If you
    decide to change the IP address or the ESSID, be sure to
    activate it with the "setup" command as described below.
  - Central tool for managing PirateBox is the init script
    /etc/init.d/piratebox. It support the following commands:
    - "setup" activates current USB and network configuration as
      described in /etc/piratebox.common. Only required during
      initial installation or after config changes.
    - "init" mounts USB drive, and sets up swap and ext3 image
      therein (for the huge python installation).
    - "update" downloads the latest PirateBox files from David
      Darts' website to USB disk.
    - "nodns" disables local DNS redirection through dnsmasq
      which is required for local maintenance work.
    - "start" and "stop" the PirateBox service, of course. The
      former also automatically calls "init" and "update" when
      it detects an un-PirateBox-ified USB disk.

REFERENCES:
 - The PirateBox project:
   http://wiki.daviddarts.com/PirateBox_DIY
 - OpenWRT - List of supported devices:
   http://wiki.openwrt.org/toh/start
 - OpenWRT documentation (look for tftp installation):
   http://wiki.openwrt.org/doc/start
 - OpenWRT "Backfire" 10.04.1-r4 images:
   http://downloads.openwrt.org/backfire/10.03.1-rc4/

